{% extends "inicio/base_dashboard.html" %}
{% load static %}

{% block content %}

<div class="bg-gray-100 p-4 md:p-8 min-h-screen">
    <div class="max-w-7xl mx-auto">

        <!-- üîî ALERTAS DE STOCK BASADAS EN DATOS REALES -->
        <div class="space-y-4 mb-6">

            {% for p in productos_bajos %}
            <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-md shadow-sm flex items-center"
                role="alert">
                <svg class="h-6 w-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                </svg>
                <p>
                    <span class="font-bold">Stock bajo:</span>
                    {{ p.nombre }} ({{ p.stock }} unidades)
                </p>
            </div>
            {% empty %}
            <div class="bg-green-100 border-l-4 border-green-500 text-green-800 p-4 rounded-md shadow-sm" role="alert">
                No hay productos con stock bajo.
            </div>
            {% endfor %}
        </div>

        <!-- üìÖ TABLA DE CITAS DE HOY (DATOS REALES) -->
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">

            <!-- üü¶ Citas (60%) -->
            <div class="lg:col-span-3 bg-white p-6 rounded-lg shadow-lg border">
                <h2 class="text-xl font-semibold mb-4">Citas de Hoy</h2>

                {% if citas_hoy %}
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead>
                            <tr class="text-gray-600 border-b">
                                <th class="py-2">Cliente</th>
                                <th class="py-2">Hora</th>
                                <th class="py-2">Servicio</th>
                                <th class="py-2">Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for c in citas_hoy %}
                            <tr class="border-b hover:bg-gray-50">
                                <td class="py-2">{{ c.cliente.username }}</td>
                                <td class="py-2">{{ c.hora|time:"H:i" }}</td>
                                <td class="py-2">{{ c.servicio.nombre }}</td>
                                <td class="py-2">
                                    <span class="px-3 py-1 rounded text-xs
                                {% if c.estado == 'atendida' %}
                                    bg-green-100 text-green-700
                                {% elif c.estado == 'pendiente' %}
                                    bg-yellow-100 text-yellow-700
                                {% else %}
                                    bg-red-100 text-red-700
                                {% endif %}
                            ">
                                        {{ c.estado|title }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% else %}
                <p class="text-gray-500">No hay citas programadas para hoy.</p>
                {% endif %}
            </div>

            <!-- üüß Inventario (40%) -->
            <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-gray-800 mb-1">Estado del Inventario</h2>
                <p class="text-sm text-gray-500 mb-4">Productos (paginado, 4 por p√°gina)</p>

                <div class="divide-y divide-gray-200">
                    {% for p in productos_page %}
                    <div class="flex justify-between items-center py-4">
                        <div>
                            <p class="font-semibold text-gray-900">{{ p.nombre }}</p>
                            <p class="text-sm text-gray-600">Stock m√≠nimo: {{ p.stock_minimo }}</p>
                        </div>

                        <div class="text-right flex-shrink-0 ml-4">
                            <p class="font-bold
                    {% if p.stock == 0 %}
                        text-red-700
                    {% elif p.stock <= p.stock_minimo %}
                        text-red-600
                    {% else %}
                        text-green-600
                    {% endif %}
                ">
                                {{ p.stock }} unidades
                            </p>

                            {% if p.stock == 0 %}
                            <span class="text-xs bg-red-700 text-white px-2 py-0.5 rounded-md font-bold uppercase">
                                Sin stock
                            </span>

                            {% elif p.stock <= p.stock_minimo %} <span
                                class="text-xs bg-yellow-500 text-white px-2 py-0.5 rounded-md font-bold uppercase">
                                Bajo
                                </span>

                                {% else %}
                                <span
                                    class="text-xs bg-green-600 text-white px-2 py-0.5 rounded-md font-bold uppercase">
                                    OK
                                </span>
                                {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-gray-500 py-4">No hay productos disponibles.</p>
                    {% endfor %}
                </div>

                <!-- PAGINACI√ìN -->
                {% if productos_page.paginator.num_pages > 1 %}
                <div class="flex justify-center items-center mt-4 space-x-2">

                    {% if productos_page.has_previous %}
                    <a href="?page={{ productos_page.previous_page_number }}"
                        class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-lg text-gray-700 font-semibold">
                        ‚óÄ Anterior
                    </a>
                    {% endif %}

                    <span class="px-3 py-1 bg-gray-300 rounded-lg text-gray-800 font-semibold">
                        P√°gina {{ productos_page.number }} de {{ productos_page.paginator.num_pages }}
                    </span>

                    {% if productos_page.has_next %}
                    <a href="?page={{ productos_page.next_page_number }}"
                        class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-lg text-gray-700 font-semibold">
                        Siguiente
                    </a>
                    {% endif %}
                </div>
                {% endif %}

                <a href=" ">
                    <button
                        class="w-full mt-6 bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg transition-colors">
                        Gestionar inventario
                    </button>
                </a>
            </div>


        </div>
    </div>
    <!-- ‚≠ê ACCESOS R√ÅPIDOS -->
    <div class="max-w-7xl mx-auto mt-14 mb-20"> <!-- üî• m√°s margen abajo -->

        <h2 class="text-2xl font-semibold mb-8 text-gray-800 text-center">Accesos R√°pidos</h2>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 place-items-center">

            <!-- ITEM -->
            <a href="#"
                class="bg-white w-full p-6 rounded-xl shadow-lg hover:shadow-xl transition-all flex flex-col items-center justify-center text-center">

                <div class="bg-blue-100 text-blue-600 p-4 rounded-full mb-4 flex items-center justify-center">
                    <svg class="h-12 w-12" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M6.75 3v2.25M17.25 3v2.25M3 7.5h18v11.25A2.25 2.25 0 0 1 18.75 21H5.25A2.25 2.25 0 0 1 3 18.75V7.5Z" />
                    </svg>

                </div>

                <p class="font-semibold text-lg text-gray-800">Nueva Cita</p>
            </a>

            <!-- ITEM -->
            <a href="#"
                class="bg-white w-full p-6 rounded-xl shadow-lg hover:shadow-xl transition-all flex flex-col items-center justify-center text-center">

                <div class="bg-green-100 text-green-600 p-4 rounded-full mb-4 flex items-center justify-center">
                    <svg class="h-10 w-10" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke-width="1.8" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-8.25A3.375 3.375 0 0 0 4.5 11.625v2.625m15 1.5h-15m15-1.5v2.625a3.375 3.375 0 0 1-3.375 3.375h-8.25A3.375 3.375 0 0 1 4.5 18.75v-2.625m16.5-1.5a.75.75 0 0 0 .75-.75V10.5h-15.75c-.621 0-1.125.504-1.125 1.125v6.75A.75.75 0 0 0 5.25 19.5h14.25a.75.75 0 0 0 .75-.75v-6.75Z" />
                    </svg>
                </div>

                <p class="font-semibold text-lg text-gray-800">Registrar Venta</p>
            </a>

            <a href="#"
                class="bg-white w-full p-6 rounded-xl shadow-lg hover:shadow-xl transition-all flex flex-col items-center justify-center text-center">

                <div class="bg-yellow-100 text-yellow-600 p-4 rounded-full mb-4 flex items-center justify-center">
                    <svg class="h-10 w-10" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke-width="1.8" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M20.25 7.5l-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10.125 6H13.875M3.75 7.5h16.5m-16.5 0l.965-3.033A1.5 1.5 0 0 1 5.25 3h13.5c.365 0 .7.18 1.05.517l.965 3.033M10.5 12h3m-3 3h3" />
                    </svg>
                </div>

                <p class="font-semibold text-lg text-gray-800">Actualizar Stock</p>
            </a>

            <!-- ITEM -->
            <a href="#"
                class="bg-white w-full p-6 rounded-xl shadow-lg hover:shadow-xl transition-all flex flex-col items-center justify-center text-center">

                <div class="bg-purple-100 text-purple-600 p-4 rounded-full mb-4 flex items-center justify-center">
                    <svg class="h-12 w-12" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 3v18h18M7.5 12l3-3 3 3 4.5-4.5" />
                    </svg>

                </div>

                <p class="font-semibold text-lg text-gray-800">Ver Reportes</p>
            </a>

        </div>

    </div>

    {% endblock %}