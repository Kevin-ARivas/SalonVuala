{% extends "inicio/base_dashboard.html" %}

{% load humanize %}
{% block content %}
<div class="min-h-screen bg-gray-100 p-4 sm:p-6 lg:p-8">

    <div class="max-w-7xl mx-auto">
    
        <div class="max-w-7xl mx-auto pt-6 mb-6 border-t-4 border-gray-400"></div>

        <div class="bg-white shadow-xl rounded-lg p-6 mb-6">
            <div class="flex justify-between items-start sm:items-center mb-4 border-b pb-4">
                <div>
                    <h1 class="text-3xl font-extrabold text-gray-900">Gesti√≥n de Inventario</h1>
                    <p class="text-base text-gray-500 mt-1">Controla el stock y productos del sal√≥n</p>
                </div>
                <a href="{% url 'agregar_producto_form' %}"
   class="bg-black text-white px-5 py-2.5 rounded-full font-semibold text-base mt-3 sm:mt-0 hover:bg-pink-500 transition-all duration-300 shadow-md hover:shadow-lg">
    + Nuevo Producto
</a>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                
                <div class="bg-white border border-gray-200 p-5 rounded-xl shadow-lg flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <h3 class="text-gray-500 font-semibold uppercase text-sm">Total Productos</h3>
                        <span class="text-gray-400 cursor-pointer hover:text-gray-600">‚ìò</span>
                    </div>
                   <p class="text-3xl font-extrabold text-gray-900 mt-1">{{ total_productos }}</p>

                    <p class="text-sm text-gray-500">En 5 categor√≠as</p>
                </div>

                <div class="bg-yellow-50 border-l-4 border-yellow-500 p-5 rounded-xl shadow-lg flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <h3 class="text-yellow-700 font-semibold uppercase text-sm">Stock Bajo</h3>
                        <span class="text-yellow-500 cursor-pointer hover:text-yellow-700">‚ö†Ô∏è</span>
                    </div>
                    <p class="text-3xl font-extrabold text-yellow-500 mt-1">{{ stock_bajo }}</p>

                    <p class="text-sm text-yellow-700">Productos requieren reposici√≥n</p>
                </div>

                <div class="bg-white border border-gray-200 p-5 rounded-xl shadow-lg flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <h3 class="text-gray-500 font-semibold uppercase text-sm">Valor Total</h3>
                        <span class="text-gray-400 cursor-pointer hover:text-gray-600">‚Æü</span>
                    </div>
                    <p class="text-3xl font-extrabold text-pink-600 mt-1">
    ${{ valor_total|intcomma }}
</p>

                    <p class="text-sm text-gray-500">Valor del inventario actual</p>
                </div>

            </div>
        </div>

        <div class="bg-white shadow-xl rounded-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-3">Filtros</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                
                <!-- üßæ FORMULARIO DE FILTRO -->
    <form method="GET">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            
            <!-- üîç BUSCAR PRODUCTO -->
            <div>
                <label for="search" class="block text-sm font-medium text-gray-700 mb-1">Buscar Producto</label>
                <div class="relative">
                    <input type="text"
                           id="search"
                           name="search"
                           placeholder="Buscar por nombre o descripci√≥n..."
                           value="{{ request.GET.search|default:'' }}"
                           class="w-full border-2 border-gray-300 focus:border-pink-500 focus:ring-pink-500 rounded-lg pl-10 pr-4 py-2 transition duration-150 ease-in-out">
                    <span class="absolute left-3 top-3 text-gray-400">üîç</span>
                </div>
            </div>

            <!-- üè∑Ô∏è CATEGOR√çA -->
            <div>
                <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Categor√≠a</label>

<select id="category"
        name="category"
        class="w-full border-2 border-gray-300 focus:border-pink-500 focus:ring-pink-500 rounded-lg px-4 py-2.5 appearance-none bg-white transition duration-150 ease-in-out"
        onchange="this.form.submit()">

    <option value="">Todas las categor√≠as</option>

    <option value="shampoo" {% if request.GET.category == 'shampoo' %}selected{% endif %}>
        Shampoo
    </option>

    <option value="acondicionador" {% if request.GET.category == 'acondicionador' %}selected{% endif %}>
        Acondicionador
    </option>

    <option value="mascarilla" {% if request.GET.category == 'mascarilla' %}selected{% endif %}>
        Mascarilla / M√°scara
    </option>

    <option value="aceite" {% if request.GET.category == 'aceite' %}selected{% endif %}>
        Aceite
    </option>

    <option value="otros" {% if request.GET.category == 'otros' %}selected{% endif %}>
        Otros
    </option>

</select>

            </div>

        </div>
    </form>
</div>
        <div class="bg-white shadow-xl rounded-lg p-6">
<h2 class="text-xl font-bold text-gray-800 mb-1">Productos ({{ productos.count }})</h2>
<p class="text-sm text-gray-500 mb-4 border-b pb-3">Lista completa del inventario</p>

{% for p in productos %}

<div class="flex justify-between items-center py-4 border-b hover:bg-gray-50 transition duration-200 px-2 -mx-2 rounded-lg">

    <div class="flex items-center space-x-4">
        {% if p.stock <= p.stock_minimo %}
            <span class="text-2xl text-red-500">üö®</span>
        {% elif p.stock <= p.stock_minimo|add:3 %}
            <span class="text-2xl text-yellow-500">üì¶</span>
        {% else %}
            <span class="text-2xl text-green-500">‚úÖ</span>
        {% endif %}

        <div>
            <p class="font-semibold text-lg text-gray-900">{{ p.nombre }}</p>
            <div class="flex space-x-2 items-center text-sm">
                <span class="bg-gray-200 text-gray-700 px-2 py-0.5 rounded-full font-medium">{{ p.get_tipo_display }}</span>

                {% if p.stock <= p.stock_minimo %}
                    <span class="bg-red-500 text-white px-2 py-0.5 rounded-full font-bold uppercase text-xs">Cr√≠tico</span>
                {% elif p.stock <= p.stock_minimo|add:3 %}
                    <span class="bg-yellow-500 text-white px-2 py-0.5 rounded-full font-bold uppercase text-xs">Bajo</span>
                {% else %}
                    <span class="bg-green-500 text-white px-2 py-0.5 rounded-full font-bold uppercase text-xs">Alto</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- üëâ ACCIONES: EDITAR / ELIMINAR -->
    <div class="flex flex-col space-y-2 text-sm">

        <a href="{% url 'editar_producto' p.id %}"
           class="text-blue-600 hover:text-blue-800 font-semibold transition">
           ‚úèÔ∏è Editar
        </a>

        <a href="{% url 'eliminar_producto' p.id %}"
           class="text-red-600 hover:text-red-800 font-semibold transition"
           onclick="return confirm('¬øSeguro que deseas eliminar este producto?');">
           üóëÔ∏è Eliminar
        </a>

    </div>

</div>

{% empty %}
<div class="text-center py-10 text-gray-500">
    No hay productos registrados a√∫n.
</div>
{% endfor %}


    </div>
</div>
{% endblock %}